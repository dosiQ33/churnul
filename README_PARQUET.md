# üì¶ CSV ‚Üí Parquet: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

## üéØ –ß—Ç–æ –¥–µ–ª–∞—é—Ç —ç—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã?

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç –≤–∞—à–∏ CSV —Ñ–∞–π–ª—ã (—Å delimiter='|', encoding='windows-1251') –≤ Parquet —Ñ–æ—Ä–º–∞—Ç –¥–ª—è:
- **–í 10 —Ä–∞–∑** –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- **–í 6 —Ä–∞–∑** –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (3 –∫–æ–º–∞–Ω–¥—ã)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pyarrow (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
```bash
pip install pyarrow
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
```bash
python quick_test.py
```
–≠—Ç–æ:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ CSV —Ñ–∞–π–ª–∞
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –µ–≥–æ –≤ Parquet (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- –ü–æ–∫–∞–∂–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- –ó–∞–π–º–µ—Ç ~3 –º–∏–Ω—É—Ç—ã –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑

### 3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã (–ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞)
```bash
python csv_to_parquet_converter.py
```
–≠—Ç–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç:
- `data/churn_train_ul.csv` ‚Üí `data/churn_train_ul.parquet`
- `data/churn_prod_ul.csv` ‚Üí `data/churn_prod_ul.parquet`

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `csv_to_parquet_converter.py` | **–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç** - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–∞–º—è—Ç–∏ |
| `quick_test.py` | **–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ CSV vs Parquet |
| `example_usage.py` | –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (5 —Ä–∞–∑–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤) |
| `PARQUET_GUIDE.md` | –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ |
| `README_PARQUET.md` | –≠—Ç–æ—Ç —Ñ–∞–π–ª |

---

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –î–æ (CSV):
```python
df = pd.read_csv(
    'data/churn_train_ul.csv',
    delimiter='|',
    encoding='windows-1251',
    thousands=',',
    low_memory=False
)
# –ñ–¥–∞—Ç—å ~60 —Å–µ–∫—É–Ω–¥ ‚è≥
```

### –ü–æ—Å–ª–µ (Parquet):
```python
df = pd.read_parquet('data/churn_train_ul.parquet')
# –ì–æ—Ç–æ–≤–æ –∑–∞ ~5 —Å–µ–∫—É–Ω–¥ ‚ö°
```

---

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏—Ö –Ω–æ—É—Ç–±—É–∫–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–í —Ñ–∞–π–ª–∞—Ö `[1] UL.ipynb` –∏ `[2] UL class.ipynb`:

**–ù–∞–π—Ç–∏:**
```python
TRAIN_INPUT_FILE = "churn_train_ul.csv"
PROD_INPUT_FILE = "churn_prod_ul.csv"
```

**–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**
```python
TRAIN_INPUT_FILE = "churn_train_ul.parquet"
PROD_INPUT_FILE = "churn_prod_ul.parquet"
```

–ò –∏–∑–º–µ–Ω–∏—Ç—å –≤ DataLoader:
```python
# –ë—ã–ª–æ:
df = pd.read_csv(
    self.file_path,
    delimiter=self.delimiter,
    encoding=self.encoding,
    thousands=',',
    low_memory=False
)

# –°—Ç–∞–ª–æ:
df = pd.read_parquet(self.file_path)
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)

```python
def load(self):
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç Parquet –µ—Å–ª–∏ –µ—Å—Ç—å)"""
    parquet_path = self.file_path.with_suffix('.parquet')

    if parquet_path.exists():
        # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Parquet (–±—ã—Å—Ç—Ä–æ!)
        df = pd.read_parquet(parquet_path)
        self.logger.info(f"‚úì Loaded from Parquet: {df.shape}")
    else:
        # Fallback –Ω–∞ CSV
        df = pd.read_csv(
            self.file_path,
            delimiter=self.delimiter,
            encoding=self.encoding,
            thousands=',',
            low_memory=False
        )
        df.columns = df.columns.str.lower().str.strip()
        self.logger.info(f"‚úì Loaded from CSV: {df.shape}")

    return df
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```python
import pandas as pd
from pathlib import Path

# –ó–∞–≥—Ä—É–∑–∫–∞
df = pd.read_parquet('data/churn_train_ul.parquet')

# –ü—Ä–æ–≤–µ—Ä–∫–∏
assert df.shape == (3243871, 195), "–ù–µ–≤–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä!"
assert 'target_churn_3m' in df.columns, "–ù–µ—Ç —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π!"
assert df['target_churn_3m'].mean() > 0.01, "–°—Ç—Ä–∞–Ω–Ω—ã–π churn rate!"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
for col in ['segment_group', 'obs_month', 'obs_quarter']:
    assert col in df.columns, f"–ö–æ–ª–æ–Ω–∫–∞ {col} –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!"
    assert df[col].dtype == 'category', f"{col} –Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω–∞—è!"

print("‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!")
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `quick_test.py` –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–µ:

```
‚ö° –°–ö–û–†–û–°–¢–¨:
   CSV:         56.23 —Å–µ–∫
   Parquet:      5.47 —Å–µ–∫
   ‚û° Parquet –±—ã—Å—Ç—Ä–µ–µ –≤ 10.3x —Ä–∞–∑!

üíæ –†–ê–ó–ú–ï–† –§–ê–ô–õ–ê:
   CSV:      5124.56 MB
   Parquet:   812.34 MB
   ‚û° –≠–∫–æ–Ω–æ–º–∏—è 84.1%!

üß† –ü–ê–ú–Ø–¢–¨:
   CSV:      2286.45 MB
   Parquet:  2286.45 MB
   ‚û° –†–∞–∑–Ω–∏—Ü–∞: 0.0% —ç–∫–æ–Ω–æ–º–∏–∏!  (—Ç–∏–ø—ã —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã)

üè∑  –¢–ò–ü–´ –î–ê–ù–ù–´–•:
   CSV: –≤—Å–µ —Ç–∏–ø—ã –Ω—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é ‚ùå
   Parquet: 3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã ‚úÖ
     - segment_group: 3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö
     - obs_month: 12 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö
     - obs_quarter: 4 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: `ModuleNotFoundError: No module named 'pyarrow'`
```bash
pip install pyarrow
```

### –û—à–∏–±–∫–∞: `FileNotFoundError: data/churn_train_ul.csv`
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CSV —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `data/`

### –û—à–∏–±–∫–∞: `UnicodeDecodeError`
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É –≤ —Å–∫—Ä–∏–ø—Ç–µ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `encoding='windows-1251'`)

### Parquet –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `compression='snappy'` (–±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è pyarrow

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:

```bash
python example_usage.py
```

–ú–µ–Ω—é –ø–æ–∫–∞–∂–µ—Ç 5 –ø—Ä–∏–º–µ—Ä–æ–≤:
1. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
2. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
3. –ó–∞–≥—Ä—É–∑–∫–∞ Parquet –Ω–∞–ø—Ä—è–º—É—é
4. –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (—Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏) ‚ö°
5. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏

---

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**: —Å–º. `PARQUET_GUIDE.md`
- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Parquet**: https://parquet.apache.org/
- **Pandas –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://pandas.pydata.org/docs/user_guide/io.html#parquet

---

## ‚ú® –ò—Ç–æ–≥

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Parquet:
- ‚úÖ –í–∞—à –ø–∞–π–ø–ª–∞–π–Ω —Å—Ç–∞–Ω–µ—Ç **–≤ 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ**
- ‚úÖ –î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—Å—è **–Ω–∞ 84%**
- ‚úÖ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ **–Ω–µ –Ω—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å**
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å **—Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏**

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –±—ã—Å—Ç—Ä–µ–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, –º–µ–Ω—å—à–µ –æ–∂–∏–¥–∞–Ω–∏—è, –±–æ–ª—å—à–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏! üöÄ
